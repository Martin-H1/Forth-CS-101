20 CONSTANT MAXITER

VARIABLE CREAL
VARIABLE CIMAG
VARIABLE ZREAL
VARIABLE ZIMAG
VARIABLE COUNT

20 LET C$ = " .,'~!^:;[/<&?oxOX#  "

: ZM ZREAL @ DUP * ;
: ZN ZIMAG @ DUP * ;
: ZL ZM ZN + ;

: .CELL
170 PRINT MID$(C$, 1 + COUNT, 1);

: DOCELL
  20 / CREAL !
  20 / CIMAG !
  CREAL @ ZREAL !
  CIMAG @ ZIMAG !
  1 COUNT !
  BEGIN
    ZM ZN ZL
110 IF ZL > 4 THEN GOTO 170
120 ZR2 = ZM - ZN + CREAL
130 ZIMAG = ZREAL * ZIMAG * 2 + CIMAG
140 ZREAL = ZR2
    COUNT @ 1 + DUP COUNT !
    MAXITER >
  UNTIL
  .CELL ;

: DOROW
  40 -39 DO
    ." X = " I . CR
    ." Y = " DUP . CR
  LOOP
  DROP ;

: MANDLEBROT
  40 -39 DO
    I DOROW CR
  LOOP ;
